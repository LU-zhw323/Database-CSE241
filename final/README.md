# EU Apartment Management System

## Name: Zhenyu Wu

## Lehigh ID: zhw323, 891058107

## Introduction

There are 3 sections in this README file:

1. Interface: Describes the functionalites of 5 different interfaces which include:
   - Prospective Tenant or New Customer
   - Tenant
   - Company Manager
   - Property Manager
   - Financial Manager
2. Operations: Describes the all the operations that can be performed by each interface in detail.
3. SQL: Describes the SQL functions, triggers, and check constraints that are used in this project.
4. Testing: Describe some of the testing process and cases.

## Note

1. I included many table visualization in the code when user need to input something, I do believe it will help in testing.
2. Please, Please, Please, **read all the sections in this README file before testing**, it will save you a lot of time, and all my extra works are included in `Operations` sections.
3. **Please open the terminal in full scree**, otherwise you may not be able to see the full table.
4. **Please scroll up frquently**, for the reason that some operations will printout multiple large tables, and you may miss some of them if you do not scroll up.
5. There are some export functions include export tables to txt file, please pay attention to the file name and location.
6. Since this project has a massive amount of printing, sometimes if you dont see further output, please press enter to continue. I guarantee non-of the operations will take to much time(probably within 5s).

## Data Soucre

All the data are generated by Mockaroo, and I have included the data in the `data` folder.

## Interface

### Prospective Tenant or New Customer

Login as a prospective tenant or new customer, user can perform following operation.

- Sign up as a new customer
  > As a person or a pet
- Login as a Prospective Tenant, pet are not allowed to login, and tenant can only login as a tenant.
  > Update personal information
  > View Property as a prospective tenant(No Permission to Export Summary table)
  > Sechedule a visit
  > Sign a Lease

Please refer to the following `Operations` section for more details about each operaitons.

### Tenant

Only tenant whose lease is not expired can login as a tenant, user can perform following operation.
if the lease is expired, the system will check if there is any unpaid payment, if there is, the system will ask user to pay the payment first.

- Update personal information
- Payment
- Add Roomates or Pet to a Lease

Please refer to the following `Operations`section for more details about each operaitons.

### Company Manager

Login as a company manager, user can perform following operation.

- View Property as a company manager(Permission to Export Summary table)
- Add New Property

Please refer to the following `Operations`section for more details about each operaitons.

### Property Manager

Login as a property manager, user can perform following operation.

- View Visit History
- View Lease
- Add Roomates or Pet to a Lease
- Move Out

Please refer to the following `Operations`section for more details about each operaitons.

### Financial Manager

Login as a financial manager, user can perform following operation.

- View Financial Report for all years or a certain year
  > export the summary table into a txt file called `FinancialReport.txt`

Please refer to the following `Operations`section for more details about each operaitons.

## Operations

1. Every input below will be checked and validated by the system. And system will output guide message for inputing.
2. Some output will printout an empty table if there is no data in the database.

### Sign up as a new customer

It will first ask if user want to sign up as a person or a pet.  
Then it will ask for all the information required for signing up.
Trigger `check_person` and `check_pet` will make sure a prospective tenant can only be either person or pet.

### Login

It will first printout tables for Prospect Tenant(person), Tenant, and Pet.
It will ask for inputing ID

- If the ID is not found, the system will output a message suggesting to sign up first.
- If the given ID is a pet, the system will output a message suggesting pets are not allowed to login.

There are two types of Login:

- Login as a tenant(selected in the first main page):
  > If the given ID is a prospective tenant, the system will output a message suggesting to sign a lease first.
- Login as perspective tenant(selected in the first main page):
  > If the given ID is a tenant, the system will output a message suggesting to login as a tenant.
  > If the given ID is a prospective tenant, the system will output a message suggesting to go back and login as a tenant.

### Update personal information

It will ask all the information from the user.
If the user is a tenant, it will ask for social security number.
Unfortunatly, I don't allow pets to login, so their information can not be updated.

### View Property

There are three types of summary tables:

1. Property and their apartments and availability(not under a lease or not), by SQL function `view_apartment_lease`
2. Property and their common amenities, by SQL function `view_property_common`
3. Apartment and their private amenities, by SQL function `view_apartment_private`

It will first print out a summary table 1.  
Then it will printout a menu with following options:

1. View all common amenities and private amenities

- This will printout two summary tables:
  > Summary table 2
  > Summary table 3

2. Search for a property and apartment with following options:

- Search by ID (property ID and apartment ID)
- Search by address, rent, availablitity of certain amenities(both common and private)
  > It will ask for address, rent, and ID for an amenity
  > User can choose to skip any of the above three options
  > It will search based on the attributes that user did not skip

3. Output a company summary(only available for Company Manager)

- This will export all three summary tables into a txt file called `PropertySummary.txt`

### Schedule a visit

It will first output a table of all the property and apartment, as well as visit history of this prosepective tenant(person).  
It will ask user to input the ID of the property and apartment.
A Prospect Tenant(person) can only schedule a visit to an apartment that he/she has not visited

### Sign a Lease

Sign a Lease with following steps:

1. Select a property and apartment with propery ID and apartment ID
2. Select a lease start date: current date or a manual input
3. Ask if user want to sign a lease(yes or not) by printout the summary table of that property and apartment
4. Ask user to add amenities to the Lease(both common and private at the same time)

- It will first printout a summary table of all amenities available for this property and apartment(both common and private)
- The lease term is fiexed to 12 months, which is enforced by SQL check constraint: `check_term`
- A Prospect Tenant(person) can only sign a lease with an apartment that he/she has visited, which will be checked by SQL function: `sign_lease`
- A Prospect Tenant(person) can be added to a existing Lease without the need to visit the apartment, which is an operation for Tenant and Property Manager
- Then it will ask user to input the ID of the amenity, user can input `q` to quit

### Payment

It will first output some tables related to apartment, amenities under a given lease, which are the same tables when Property Manager view a Lease detail.  
Then It will calculate the total amount of payment for a given lease based on payment records.
We are a nice company so we allow tenants to keep their lease even if they have unpaid payment, they just need to pay all the unpaid payment at once.^\_^

- The monthly bill is due on the same date each month
- The system will sum up all the previously unpaid payment together.
- Tenant can only pay all the amount due at once.
- The system will update the payment record accordingly.
- The system will accept following payment method:
  > Transfer
  > Credit Card & Debit Card
  > Both payment method support information auto-generation.
  > Trigget `check_transfer` and `check_card` will make sure a payment can only be made by one of the above two methods.
- Monthly Bill is calculated by SQL function: `calculate_total_bill`
- Total number of payment is calculated by SQL function: `calculate_due_rent_payments`
- If payment succeed, the system will output a message and back to the main page.
- If no payment is due, the system will output a message and back to the main page.

### Add Roomates or Pet to a Lease

It will first output a table of available roomates or pets.  
Adding by inputing the ID of the roomate or pet.Therefore, signups are required before adding.  
Please notice that only allow one pet per lease.

- The System will check if an inputting ID is valid.
- The System will check if an inputting ID is a customer or a pet.
- The System will check if the roomate or pet is already in the lease.
- The System will check if this lease already has a pet.

### Add New Property

It will first ask if user want to add a new property by manually inputing all the information or use auto-generation. Each input will be checked and validated by the system(eg. If user add a already seletected private amenities to a apartment).
An amenity can only be either common or private, which is enforced by SQL trigger `check_common_amenity`and `check_private_amenity`.

- Auto-generation
  > Generate a random address
  > Ask how many apartments to generate, and generate that many apartments
  > Ask how many common amenities this property has, and randomly select that many common amenities
  > For each apartment
  > Ask How many private amenities this apartment has, and randomly select that many private amenities
- Manually input
  > Ask for address
  > Ask for number of apartments
  > Ask for rent, size, number of bedrooms, number of bathrooms for each apartment
  > Ask for number of common amenities
  > Ask for ID of each common amenity
  > For each apartment
  > Ask for number of private amenities
  > Ask for ID of each private amenity

### View Visit History

It will first output a table of all the property and apartment
Then it will ask if user want to view all visit history or view visit history of a certain property and apartment

- Yes:
  > It will ask user to input the ID of the property and apartment
  > It will output a table of visit history of a certain property and apartment
- No:
  > It will output a table of all visit history

### View Lease

It will first output a table of all the property and apartment
Then it will ask if user want to view detail infomation of a certain lease or not

- Yes:
  > It will ask user to input the ID of lease
  > It will output following tables:
  > Property and apartment information related to this lease
  > Selected Common Amenities
  > Selected Private Amenities
  > Lease information
  > Tenant information
  > Pet information
  > Monthly Charge

### Move Out

It will first output a table of all the lease, as well as a table of lease that are expired already
We are a brutal company, so we will grant property manager the privilege to move out any lease, even if it is not expired yet.^\_^

- It will ask user to input the ID of lease
- It will then output the detail information of this lease and ask for confirmation
- Then it will ask the confirmation again about refunding the deposit, I have created a card for EU. All EU refund will be using card payment.
- After refund and delete the Lease, all the related data, including lease, tenants and pets, selected amenities will be deleted automatically.
- It will keep the payment record, but the `lease_id` will be set to null.

### View Financial Report

It provides two options:

1. View the financial report of all years
2. View the financial report of a certain year

For both options, it will output a summary table first which includes total revenue as well as total expense
Then it will ask if user want to view the detail information of revenue and expense or not
Lastly, it will ask user if he/she want to export the summary table into a txt file called `FinancialReport.txt`

## SQL

### Functions

1. `view_property_common`
   > This function takes a property ID as input
   > If property ID is null, it will return all the common amenities information for all properties
   > If property ID is not null, it will return all the common amenities information for that property
2. `view_apartment_private`
   > This function takes a property ID and apartment ID as input
   > If property ID and apartment ID are null, it will return all the private amenities information for all apartments
   > If property ID and apartment ID are not null, it will return all the private amenities information for that apartment
3. `view_apartment_lease`
   > This function takes a property ID , apartment ID and lease ID as input
   > If lease ID is not null, it will return the apartments information as well as the availability of that apartment under that lease
   > If property ID and apartment ID are not null, it will return all the apartments information as well as the availability of that apartment
   > If all the input are null, it will return all the apartments information as well as the availability of that apartment for all leases
4. `calculate_total_bill`
   > This function takes a lease ID as input
   > It will return the total amount of monthly payment(rent + total cost of amenities) for that lease
5. `calculate_due_rent_payments`
   > This function takes a lease ID as input
   > It will return the total number of unpaid monthly payment for that lease(comparing the current date with the lease start date)
6. `sign_lease`
   > This function takes a lease ID as input
   > It will inser a new lease if that prospective tenant(person) has visited that apartment

### Triggers

1. `check_person`
   > This trigger will check if a prospective tenant(person) is also a pet
   > If a prospective tenant(person) is also a pet, it will raise an error
2. `check_pet`
   > This trigger will check if a prospective tenant(pet) is also a person
   > If a prospective tenant(pet) is also a person, it will raise an error
3. `check_common_amenity`
   > This trigger will check if an amenity is both common and private
   > If an amenity is both common and private, it will raise an error
4. `check_private_amenity`
   > This trigger will check if an amenity is both common and private
   > If an amenity is both common and private, it will raise an error
5. `check_transfer`
   > This trigger will check if a payment is made by both transfer and card
   > If a payment is made by both transfer and card, it will raise an error
6. `check_card`
   > This trigger will check if a payment is made by both transfer and card
   > If a payment is made by both transfer and card, it will raise an error

## Testing

Please follow the following steps to test the functionalities of this project, I promise it will cover all the functionalities. And it will save you a lot of works.

### Sign up as a new customer

1. Go to option `2. New Customer or Prosepctive Tenant`
2. Go to option `2. Sign up as Prosepctive Tenant`
3. Enter all the information required, also indentify if this prospective tenant is a person or a pet
4. Success: The system will output a table of summary information of this prospective tenant
5. Use that ID to login as a prospective tenant, you can try pet as well, but pet will be rejected when login

### Login as Prospective Tenant

1. Go to option `2. New Customer or Prosepctive Tenant`
2. Go to option `1. Login with ID`
3. Enter the ID of a prospective tenant, it will print three tables: tenant, propspective tenant(person), and pet
4. Try login as a tenant, pet first, the system will block you
5. Try again use any ID from the table of prospective tenant(person)
6. Success: You will see a new menu, and we can start testing functionalities for prospective tenant(person)

### Update personal information

1. After you login, you can see a personal information table above the menu
2. Go to option `1. Update Customer Info`
3. Enter all the information required.
4. When you back to the main page, you can see the personal information table is updated

### View Property as a prospective tenant

1. After you login, you can see a personal information table above the menu
2. Go to option `2. View Property & Apartment Info`
3. Since you are not manager, you dont have the permission to export the summary table
4. It will printout a large summary table of all apartments and their availability
5. Go to option `1. View All Property & Apartment Amenities` , it will printout two more summary tables one for common amenities and one for private amenities
6. Go to option `2. Search for Property & Apartment`, you will be guided to another search meanu
7. You can search by Property ID, Apartment ID in option `1. Search by ID`
8. You can search by address, rent, and amenity ID in option `2. Search by Address, Rent, and Amenity ID`
   > Please also try the optional search functionalities by skipping some of the input
   > For example, if you skip the address, but input the rent and amenity ID, the system will search for all the apartments with that rent and amenity ID

### Schedule a visit

1. Go back to the main page when you see the customer information table
2. Go to option `3. Schedule a Visit`
3. It will first print the same summary table of all apartments and their availability
4. Then it will also print a table of visit history of this prospective tenant(person), if you have not visited any apartment, it will be empty
5. Enter the ID of the property and apartment based on the summary table
6. Success: It will print a message saying you have scheduled a visit to that apartment and back to the main page
7. Go to option `3. Schedule a Visit` again, you will see the visit history table is updated
8. You can try visit the same property and apartment again, the system will block you

### Sign a Lease

1. Go back to the main page when you see the customer information table
2. Go to option `4. Sign a Lease and Select Amenities`
3. It will print the same tables as when you schedule a visit
4. Enter the ID of the property and apartment you want to sign a lease
5. Also You can go back to previous step to visit an apartment that is not available, then back here to sign a lease on that apartment. The system will block you.
6. After you enter the ID, it will print a summary table of that property and apartment, and ask if you want to use the current date as the lease start date or input a manual date(for testing move out)
   > I strongly suggest to use two prospective tenant(person) to sign two leases
   > **One with current date, which means lease will be valid** > **One with manual date(like 2020), which means lease will be expired**
7. Then it will ask you to confirm if you want to sign a lease on that apartment
8. Then it will ask for a 9-digit social security number, please just enter any 9-digit number
9. If this prospective tenant(person) has not visited this apartment, it will print a message saying you have not visited this apartment, and back to the main page(if you dont see it, please scroll up)
10. Then it will ask for selecting amenities, it will first print two summary table of both common amenities and private amenities available for this property and apartment
11. Just enter the ID of the amenity you want to add, you can enter `q` to quit
12. Then you will see a message after you enter `q`, it will log you out and back to the main page and tell you to login as a tenant instead
13. Now you can try use the same ID to login as prospective tenant(person), the system will block you, which means you have signed a lease successfully

### Login as a Tenant

1. Go back to the main page when you see the table of all 6 interfaces
2. Go to option `1. Tenant`
3. Same as the the Login as a prospective tenant(person), it will print three tables: tenant, propspective tenant(person), and pet
4. But this time, it will only allow you to login as a tenant
5. If you follow my suggestion to use two prospective tenant(person) to sign two lease, one with valid lease and one with expired lease. You can try use the valid one first. And use the expired one when we testing move out.
6. Success: You will see a new menu, and a personal information table

### Add Roomates or Pet to a Lease

1. Go to option `3. Add Roomates or Pet to a Lease`
2. It will print two tables, one for available roomates and one for available pets
3. You can add as much as roomates as you want, but only one pet is allowed for each Lease

### Payment

1. Go to option `2. View My Apartment & Payment`
2. It will print all the information regarding to that lease, please scroll up to see all the tables
   > Property and apartment information
   > Common amenities
   > Private amenities
   > Lease information
   > Tenant information
   > Pet information
   > Monthly Charge
   > Finally the total amount of payment based on the number of unpaid payment
3. We can try 3 cases
   > One with no unpaid payment which is the **one you just signed using current date**
   > One with only one unpaid payment, you can login with this one: `Tenant ID: 6`
   > One with multiple unpaid payment, you can login with this one: `Tenant ID: 24`
4. If there is no unpaid payment, the system will print a message saying there is no unpaid payment, and back to the main page
5. If there is unpaid payment, the system will ask if you want to pay all the unpaid payment at once by card or transfer
6. Go with both options, the systemt will ask for manual input or auto-generation
7. After you make payment, the system will go back to the main page
8. You can go to option `2. View My Apartment & Payment` again, you will see the payment record is updated, no payment is due now

### View Property as a Company Manager

1. Go back to the main page when you see the table of all 6 interfaces
2. Go to option `4. Company Manager`
3. Go to option `1. View Property & Apartment Info`
4. All opertions I mentioned in `View Property as a prospective tenant` are also available for company manager
5. The only difference is that company manager has the permission to export the summary table
6. Go to option `3. Output Company Summary`, it will export all three summary tables into a txt file called `PropertySummary.txt`

### Add New Property

1. Go back to the main page of company manager
2. Go to option `2. Add New Property`
3. Test and play with both auto-generation and manual input

### View Visit History

1. Go back to the main page when you see the table of all 6 interfaces
2. Go to option `3. Property Manager`
3. Go to option `1. View Visit Data`
4. Once again you will see the property and apartment availibity summary table, but now it will show the actual lease_id
5. It will ask if you want to check visit data for a specific property and apartment
6. If you choose yes, it will ask for the ID of the property and apartment
7. If you choose no, it will print a table of all visit history

### View Lease

1. Go back to the page of property manager
2. Go to option `2. View Lease`
3. Once again you will see the property and apartment availibity summary table, but now it will show the actual lease_id
4. It will ask if you want to check detail data for a specific lease
5. If you choose yes, it will ask for the ID of the lease, and printout following tables
   > Property and apartment information related to this lease
   > Selected Common Amenities
   > Selected Private Amenities
   > Lease information
   > Tenant information
   > Pet information
   > Monthly Charge
6. If you choose no, it go back to the main page of property manager

### Move Out

1. First we can use that **account with expired lease** to login as a tenant, or you can use this one: `Tenant ID: 41`
2. You will see a message saying your lease is expired, and it will also check if you have any unpaid payment. ALso can you record the lease ID of this tenant, we will use it later. You can find it in the table outputed by the system.
3. If so, it will ask you to pay all the unpaid payment
4. Then we can back to the `Move Out` operation of property manager
5. You will see tow tables printed out, one for all the lease, one for all the expired lease
6. Then choose any lease ID you like, cause Like I mentioned we are a brutal company ^\_^
7. It will print out the detail information of that lease, and ask for confirmation
8. Then it will ask for confirmation again about refunding the deposit
9. After all the confirmation, it will delete the lease and all the related data, and refund the deposit
   > All tenants and pets will be deleted
   > All selected amenities will be deleted
   > All payment records will be kept, but the lease_id will be set to null
10. When you try `Move Out` again, you wont find the lease you just deleted
11. WHen you go back and try to login with that tenant ID, you will see a message saying please sign a lease first, which means now he/she is a prospective tenant(person) again

### View Financial Report

1. Go back to the main page when you see the table of all 6 interfaces
2. Go to option `5. Financial Manager`
3. Both `View Financial Report for all years` and `View Financial Report for a certain year` will print a summary table first which includes total revenue as well as total expense for all years
4. Lastly, it will ask if user want to export the summary table into a txt file called `FinancialReport.txt`
